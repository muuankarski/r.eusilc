<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <meta name="author" content="Markus Kainu" />
  <title>Merging EU-SILC raw data using r.eusilc-package</title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
  </style>
  <style>
  
  @font-face {
    font-family: 'Lato';
    font-style: normal;
    font-weight: 400;
    src: local('Lato Regular'), local('Lato-Regular'), url(fonts/Lato.woff) format('woff');
  }
  @font-face {
    font-family: 'Lato';
    font-style: normal;
    font-weight: 700;
    src: local('Lato Bold'), local('Lato-Bold'), url(fonts/LatoBold.woff) format('woff');
  }
  @font-face {
    font-family: 'Lato';
    font-style: normal;
    font-weight: 900;
    src: local('Lato Black'), local('Lato-Black'), url(fonts/LatoBlack.woff) format('woff');
  }
  @font-face {
    font-family: 'Lato';
    font-style: italic;
    font-weight: 400;
    src: local('Lato Italic'), local('Lato-Italic'), url(fonts/LatoItalic.woff) format('woff');
  }
  
  
  -something { /* Just to escape the effect of html tag above in pandoc*/
  
  }
  
  .title /* Pandoc title header (h1.title) */
      {
      text-align: center;
  	border-width:0px;
  	font-size: 1.5em;
  	margin: 0 0 5px 0;
  	word-spacing: .1em;
  	border-bottom: 0px;
  	text-transform:none;
      }
  
  .author /* Pandoc author(s) header (h2.author) */
      {
      text-align: center;
      font-size: 1.1em;
      line-height: 1.2em;
      border-bottom: 0px;
      }
  
  .date /* Pandoc date header (h3.date) */
      {
  	font-family:  Lato, Arial;
  	text-align: center;
  	font-size: 1.1em;
  	line-height: 1.2em;
      }
  
  
  body {
      margin-left: 240px;
      max-width:750px; 
      border: 0px;
      font-family: Lato, Helvetica, sans-serif;
  }
  
  
  #toc {
      font-size:0.9em;
      height: 100%;
      position: fixed;
      width: 220px;
      left: 5px;
      padding-top: 20px;
      color: #003333;
      border-right: 1px dashed #C1C1C1;
  }
  
  #toc_header {
      font-size: 1em;
      font-weight: bold;    
      border-bottom: 1px dashed #C1C1C1;
      color: black;
  }
  
  
  
  #TOC li {
      padding: 2px 4px;
      margin-left: 2px;
  }
  
  
  #TOC a {
      color: #003333;
      display: block;
  }
  
  
  #TOC {
      font-size:0.9em;
      height: 100%;
      position: fixed; 
      width: 220px;
      left: 5px;
      padding-top: 20px;
      color: #003333;
      border-right: 1px dashed #C1C1C1;
  }
  
  #TOC_HEADER {
      font-size: 1em;
      font-weight: bold;    
      border-bottom: 1px dashed #C1C1C1;
      color: black;
  }
  
  
  
  #TOC li {
      padding: 2px 4px;
      margin-left: 2px;
  }
  
  
  #TOC a {
      color: #003333;
      display: block;
  }
  
  
  blockquote {
  	padding-left: .5em; 
      border-left: 2px solid #C1C1C1;
  	font-style: italic;
  }
  
  
  pre {	
     margin-top: 0;
     max-width: 95%;
     border: 1px dashed #ccc;
     white-space: pre-wrap;
     font-size:1.0em;
      background: #FFFFFF;
  }
  
  pre code {
     display: block; 
     padding: 0.2em;
     font-size:1.0em;
  }
  
  code.r, code.cpp {
     background-color: #ECEEF0;
  }
  
  
  
  ul {
  	font-size: 100% !important;
  	font-family: Lato, Helvetica, sans-serif;
  }
  li {
  	font-family: Lato, Helvetica, sans-serif;
   	font-size: 1em;
   	line-height: 1.1em;
  }
  
  
  p {
  	font-family: Lato, Helvetica, sans-serif;
  	padding-top: 2px;
  	padding-bottom: 2px;
  	font-size: 1em;
  	line-height: 1.2em;
  }
  ol {
  	list-style: decimal outside;
  	list-style-type: decimal;
  	float: none;
  	margin: .5em 0 .5em 30px;
  	padding: 0;
  }
  ul {
  	margin: .2em 0 .2em 10px;
  	padding: 0;
  }
  UL li, ol li {
  	line-height: 1.1em;
  	padding: 2px;
  }
  a:link {
  	color: #657b83;
     /* text-decoration: none; */
  }
  a:hover {
  	color: #657b83;
  }
  a:visited {
  	color: #657b83;
  }
  a:focus {
  	color: #657b83;
  }
  a:active {
  	color: #657b83;
  }
  
  h1 {
  	font-family:  Lato, Arial;
  	font-size: 1.3em;
  	padding: 2px;
  	line-height: 1.3em;
      font-weight: 400;
  	/*letter-spacing: 0.06em;
  	word-spacing: .1em;*/
      border-bottom: 0.5px solid #657b83;
  	text-transform:uppercase;
      color: #657b83;
  }
  h2 {
  	font-family:  Lato, Arial;
  	font-size: 1.1em;
  	padding: 2px;
  	line-height: 1.1em;
      font-weight: 300;
  	letter-spacing: 0.05em;
  	word-spacing: .1em;
  	border-bottom: 0.5px dashed #657b83;
  /*	text-transform:capitalize;*/
      color: #657b83;
  
  }
  h3 {
  	font-family:  Lato, Arial;
  	font-size: 1.1em;
  	padding: 2px;
  	line-height: 1.1em;
      font-weight: 300;
  	letter-spacing: 0.05em;
  	word-spacing: .1em;
      color: #657b83;
  
  }
  h4 {
  	font-family: Lato;
  	font-size: 1.0em;
  	padding: 2px;
  	line-height: 1.0em;
  	color: #555;
  	font-weight: italic;
      color: #657b83;
  }
  h5 {
  	font-family: Avant Garde;
  	font-size: 1.05em;
  	padding: 2px;
  	line-height: 1.15em;
  	color: #555;
  	font-weight: normal;
      color: #657b83;
  }
  h6 {
  	font-family: Lato;
  	font-size: 1em;
  	padding: 2px;
  	line-height: 1.1em;
  	color: #555;
  	font-weight: normal;
      color: #657b83;
  }
  p.caption, table caption, caption{
      margin-top:0em;
      padding:2px;
      font-weight: 600;
      font-size:1.0em;
      text-align:left;
      color: #657b83;
  }
  
  /* table styles */
  table {
  	border-collapse: collapse;
  	border-spacing: 0;
      line-height: 1.4em;
  	font-size: 0.9em;
  	/*font-family: monospace;*/
  
  }
  .views-table, table {
  	margin-left: 2px;
  	margin-bottom: 10px;
  	/*width: 1300px;*/
  }
  tr {
  	line-height: 1.2em;
  	border-bottom: #9e9e9e thin solid;
  }
  tr:last-child {
  	line-height: 1.2em;
  }
  th {
  	margin: 5px 0 5px 0;
  	padding: 0 5px 0 5px;
  /*	border-right: #9e9e9e thin solid; */
  	text-align: left;
  	border-bottom: #9e9e9e thin solid;
  }
  th:last-child {
  	margin: 5px 0 5px 0;
  	padding: 0 5px 0 5px;
  /*	border-right: #9e9e9e thin solid; */
  	text-align: left;
  }
  th:first-child {
  	margin: 5px 0 5px 0;
  	padding: 0 5px 0 5px;
  /*	border: #9e9e9e thin solid; */
  }
  tbody tr {
  	line-height: 1.2em;
  /*	border-left: #9e9e9e thin solid; */
  }
  tbody tr:nth-child(odd) {
  	line-height: 1.2em;
  	background-color: #F3F5F5;
  }
  td {
  	padding: 0 5px 0 5px;
  /*	border-right: #9e9e9e thin solid; */
  }
  td:last-child {
  	padding: 0 5px 0 5px;
  }
  DL {
  	margin: .3em 0 .3em 0;
  }
  DT {
  	margin: .3em 0 .3em 0;
  }
  DD {
  	line-height: 1.5em;
  	list-style: none;
  	margin: .7em 0 .7em 2em;
  }
  td.active {
  	background-color: transparent!important;
  }
  tr:last-child {
  	border-bottom: #9e9e9e thin solid;
  }
  tr:first-child {
  	border-top: #9e9e9e thin solid;
  }
  th:last-child {
  /*	border-left: #9e9e9e thin solid; */
  }
  th:last-child {
  	/*border-right: #9e9e9e thin solid;*/
  }
  </style>
  
  <link href='http://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>
</head>
<body>
<div id="header">
<h1 class="title">Merging EU-SILC raw data using r.eusilc-package</h1>
<h2 class="author">Markus Kainu</h2>
<h3 class="date">20.11.2014</h3>
</div>
<div id="TOC">
<ul>
<li><a href="#merging-eu-silc-raw-data-using-r.eusilc-package"><span class="toc-section-number">1</span> Merging EU-SILC raw data using r.eusilc-package</a></li>
<li><a href="#preparations"><span class="toc-section-number">2</span> Preparations</a><ul>
<li><a href="#specifying-the-paths-or-original-.csv-files"><span class="toc-section-number">2.1</span> Specifying the paths or original .csv files</a></li>
<li><a href="#installing-r.eusilc-package"><span class="toc-section-number">2.2</span> Installing r.eusilc-package</a></li>
</ul></li>
<li><a href="#examples"><span class="toc-section-number">3</span> Examples</a><ul>
<li><a href="#household-level-dataset-from-cross-sectional-data"><span class="toc-section-number">3.1</span> Household level dataset from cross-sectional data</a></li>
<li><a href="#individual-level-dataset-from-cross-sectional-data"><span class="toc-section-number">3.2</span> Individual level dataset from cross-sectional data</a></li>
<li><a href="#individual-level-dataset-with-household-level-variables-from-cross-sectional-data"><span class="toc-section-number">3.3</span> Individual level dataset with household level variables from cross-sectional data</a></li>
<li><a href="#individual-level-dataset-with-household-level-variables-from-longitudinal-data"><span class="toc-section-number">3.4</span> Individual level dataset with household level variables from longitudinal data</a></li>
<li><a href="#pooled-individual-level-dataset-with-household-level-variables-from-longitudinal-data"><span class="toc-section-number">3.5</span> Pooled individual level dataset with household level variables from longitudinal data</a><ul>
<li><a href="#selecting-identical-variables-only-nordic-countries-from-both-datasets"><span class="toc-section-number">3.5.1</span> Selecting identical variables &amp; only Nordic countries from both datasets</a></li>
<li><a href="#row-binding-the-datasets-removing-duplicates"><span class="toc-section-number">3.5.2</span> Row binding the datasets &amp; removing duplicates</a></li>
</ul></li>
</ul></li>
</ul>
</div>
<h1 id="merging-eu-silc-raw-data-using-r.eusilc-package"><span class="header-section-number">1</span> Merging EU-SILC raw data using r.eusilc-package</h1>
<p>This tutorial will go through a process for merging EU-SILC raw .csv data files using <a href="https://github.com/muuankarski/r.eusilc">r.eusilc</a>-package and creating an analysis ready-dataset. Tutorial will explain five different scenarios for creating datasets:</p>
<ol style="list-style-type: decimal">
<li>Household level dataset from cross-sectional data</li>
<li>Individual level dataset from cross-sectional data</li>
<li>Individual level dataset with household level variables from cross-sectional data</li>
<li>Individual level dataset with household level variables from longitudinal data</li>
<li>Pooled individual level dataset with household level variables from longitudinal data</li>
</ol>
<p>All the analysis are implemented in R, but the output data can be formatted also for proprietary software, like <em>SPSS</em>, <em>SAS</em> or <em>Stata</em>.</p>
<p>This demo will use data from 2010, but in the 5th example will pool it with data from 2009.</p>
<h1 id="preparations"><span class="header-section-number">2</span> Preparations</h1>
<p><strong>Requirements:</strong></p>
<ul>
<li>16 GB of RAM</li>
<li>time. The third example takes about 15 minutes to run on my computer</li>
</ul>
<p>Eu-silc datasets are delivered on a laser disc, where you have on each disc a four .csv files representing one either <em>cross-sectional</em> or <em>longitudinal</em> version of data. Raw .csv-files are named as <code>UDB_L06D_ver 2006-2 from 01-03-2009</code>, that in this case would mean:</p>
<ul>
<li>user database</li>
<li>longitudinal</li>
<li>d-file (household register)</li>
<li>from year 2006 revision 2</li>
<li>published year 2009</li>
</ul>
<h2 id="specifying-the-paths-or-original-.csv-files"><span class="header-section-number">2.1</span> Specifying the paths or original .csv files</h2>
<p>You have to specify path to each of the four original .csv files for the following parameters:</p>
<pre><code>path.personal.register
path.personal.data
path.household.register
path.household.data</code></pre>
<p>Consider structuring your raw data archive into something like (this is how my data is organised for this demo):</p>
<pre class="sourceCode r"><code class="sourceCode r">demo_data
|\
|<span class="st"> </span>\-eusilc_raw
|<span class="st">    </span><span class="er">|</span>-----<span class="dv">2010</span>
|<span class="st">    </span><span class="er">|</span><span class="st">      </span><span class="er">|</span>---longi_rev3
|<span class="st">    </span><span class="er">|</span><span class="st">      </span><span class="er">|</span><span class="st">    </span><span class="er">|</span>--------<span class="st"> </span>UDB_l10R_ver <span class="dv">2010-4</span> from <span class="dv">01-03</span><span class="fl">-2014.</span>csv
|<span class="st">    </span><span class="er">|</span><span class="st">      </span><span class="er">|</span><span class="st">    </span><span class="er">|</span>--------<span class="st"> </span>UDB_l10P_ver <span class="dv">2010-4</span> from <span class="dv">01-03</span><span class="fl">-2014.</span>csv
|<span class="st">    </span><span class="er">|</span><span class="st">      </span><span class="er">|</span><span class="st">    </span><span class="er">|</span>--------<span class="st"> </span>UDB_l10D_ver <span class="dv">2010-4</span> from <span class="dv">01-03</span><span class="fl">-2014.</span>csv
|<span class="st">    </span><span class="er">|</span><span class="st">      </span><span class="er">|</span><span class="st">    </span><span class="er">|</span>--------<span class="st"> </span>UDB_l10H_ver <span class="dv">2010-4</span> from <span class="dv">01-03</span><span class="fl">-2014.</span>csv
|<span class="st">    </span><span class="er">|</span><span class="st">      </span><span class="er">|</span>---cross_rev4
|<span class="st">    </span><span class="er">|</span><span class="st">      </span><span class="er">|</span><span class="st">    </span><span class="er">|</span>--------<span class="st"> </span>UDB_c10R_ver <span class="dv">2010-5</span> from <span class="dv">01-03</span><span class="fl">-14.</span>csv
|<span class="st">    </span><span class="er">|</span><span class="st">      </span><span class="er">|</span><span class="st">    </span><span class="er">|</span>--------<span class="st"> </span>UDB_c10P_ver <span class="dv">2010-5</span> from <span class="dv">01-03</span><span class="fl">-14.</span>csv
|<span class="st">    </span><span class="er">|</span><span class="st">      </span><span class="er">|</span><span class="st">    </span><span class="er">|</span>--------<span class="st"> </span>UDB_c10D_ver <span class="dv">2010-5</span> from <span class="dv">01-03</span><span class="fl">-14.</span>csv
|____|______|____|--------<span class="st"> </span>UDB_c10H_ver <span class="dv">2010-5</span> from <span class="dv">01-03</span><span class="fl">-14.</span>csv
|<span class="st">    </span><span class="er">|</span>-----<span class="dv">2011</span>
|<span class="st">    </span><span class="er">|</span><span class="st">      </span><span class="er">|</span>---longi_rev1
|<span class="st">    </span><span class="er">|</span><span class="st">      </span><span class="er">|</span><span class="st">    </span><span class="er">|</span>--------<span class="st"> </span>UDB_l11R_ver <span class="dv">2011-2</span> from <span class="dv">01-03</span><span class="fl">-2014.</span>csv
|<span class="st">    </span><span class="er">|</span><span class="st">      </span><span class="er">|</span><span class="st">    </span><span class="er">|</span>--------<span class="st"> </span>UDB_l11P_ver <span class="dv">2011-2</span> from <span class="dv">01-03</span><span class="fl">-2014.</span>csv
|<span class="st">    </span><span class="er">|</span><span class="st">      </span><span class="er">|</span><span class="st">    </span><span class="er">|</span>--------<span class="st"> </span>UDB_l11D_ver <span class="dv">2011-2</span> from <span class="dv">01-03</span><span class="fl">-2014.</span>csv
|____|______|____|--------<span class="st"> </span>UDB_l11H_ver <span class="dv">2011-2</span> from <span class="dv">01-03</span><span class="fl">-2014.</span>csv
|\
|<span class="st"> </span>\-eusilc_merged
|<span class="st">    </span><span class="er">|</span>---<span class="dv">2009</span>
|<span class="st">    </span><span class="er">|</span><span class="st">     </span><span class="er">|</span>-----<span class="st"> </span>per_longi.csv
|<span class="st">    </span><span class="er">|</span><span class="st">     </span><span class="er">|</span>-----<span class="st"> </span>hh_longi.csv
|<span class="st">    </span><span class="er">|</span><span class="st">     </span><span class="er">|</span>-----<span class="st"> </span>hh_cross.csv
|<span class="st">    </span><span class="er">|</span><span class="st">     </span><span class="er">|</span>-----<span class="st"> </span>hh_cross.csv
|<span class="st">    </span><span class="er">|</span>---<span class="dv">2010</span>
|<span class="st">    </span><span class="er">|</span><span class="st">     </span><span class="er">|</span>-----<span class="st"> </span>per_longi.csv
|<span class="st">    </span><span class="er">|</span><span class="st">     </span><span class="er">|</span>-----<span class="st"> </span>hh_longi.csv
|<span class="st">    </span><span class="er">|</span><span class="st">     </span><span class="er">|</span>-----<span class="st"> </span>hh_cross.csv
|____|_____|-----<span class="st"> </span>hh_cross.csv</code></pre>
<h2 id="installing-r.eusilc-package"><span class="header-section-number">2.2</span> Installing r.eusilc-package</h2>
<p>For installation you need to have <strong>devtools</strong>-package installed with <code>install.packages(&quot;devtools&quot;)</code>. In Windows you will need <a href="http://cran.r-project.org/bin/windows/Rtools/index.html">RTools</a> to be installed before installing <strong>devtools</strong>-package.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(devtools)
<span class="kw">install_github</span>(<span class="st">&quot;r.eusilc&quot;</span>,<span class="st">&quot;muuankarski&quot;</span>)
<span class="kw">library</span>(r.eusilc)</code></pre>
<p>There is only one function <code>merge_eusilc()</code> in the package. Typing <code>?merge_eusilc</code> will print you the help file.</p>
<h1 id="examples"><span class="header-section-number">3</span> Examples</h1>
<h2 id="household-level-dataset-from-cross-sectional-data"><span class="header-section-number">3.1</span> Household level dataset from cross-sectional data</h2>
<p>Here we are merging the household register file with household data file. Function reads the raw -csv files in <code>~/data_demo/eusilc_raw/2010/cross_rev4</code>and writes the merged output in <code>csv</code> format in <code>~/data_demo/eusilc_merged/2010</code> with filename <code>2010hh_merge_cross.csv</code>. In addition, function returns <code>data.frame</code> object <code>hh_cross_2010</code> in the R session.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(r.eusilc)
hh_cross_2010 &lt;-<span class="st"> </span><span class="kw">merge_eusilc</span>(<span class="dt">path.household.register =</span> <span class="st">&quot;~/demo_data/eusilc_raw/2010/cross_rev4/UDB_c10D_ver 2010-5 from 01-03-14.csv&quot;</span>,
                              <span class="dt">path.household.data     =</span> <span class="st">&quot;~/demo_data/eusilc_raw/2010/cross_rev4/UDB_c10H_ver 2010-5 from 01-03-14.csv&quot;</span>,
                              <span class="dt">output.path=</span><span class="st">&quot;~/demo_data/eusilc_merged/2010&quot;</span>,
                              <span class="dt">level=</span><span class="st">&quot;household&quot;</span>,
                              <span class="dt">type=</span><span class="st">&quot;cross-sectional&quot;</span>,
                              <span class="dt">year=</span><span class="st">&quot;2010&quot;</span>,
                              <span class="dt">format=</span><span class="st">&quot;csv&quot;</span>,
                              <span class="dt">subset.vars.per.reg=</span><span class="st">&quot;all&quot;</span>,
                              <span class="dt">subset.vars.per.data=</span><span class="st">&quot;all&quot;</span>,
                              <span class="dt">subset.vars.hh.reg=</span><span class="st">&quot;all&quot;</span>,
                              <span class="dt">subset.vars.hh.data=</span><span class="st">&quot;all&quot;</span>,
                              <span class="dt">subset.countries=</span><span class="st">&quot;all&quot;</span>) </code></pre>
<p>You can create a boxplot on <em>total disposable household income</em> <a href="http://www.gesis.org/?id=2649#HY020"><code>HY020</code></a> by country <a href="http://www.gesis.org/?id=2634#DB020"><code>DB020</code></a> with following code:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
<span class="kw">ggplot</span>(hh_cross_2010, <span class="kw">aes</span>(<span class="dt">x=</span><span class="kw">factor</span>(<span class="kw">reorder</span>(DB020, HY020, median, <span class="dt">na.rm=</span><span class="ot">TRUE</span>)), <span class="dt">y=</span>HY020)) +<span class="st"> </span>
<span class="st">  </span><span class="kw">geom_boxplot</span>() +<span class="st"> </span>
<span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">80000</span>))</code></pre>
<div class="figure">
<img src="figure/case1plot.png" />
</div>
<h2 id="individual-level-dataset-from-cross-sectional-data"><span class="header-section-number">3.2</span> Individual level dataset from cross-sectional data</h2>
<p>Here we are merging the personal register file with personal data file. Function reads the raw -csv files in <code>~/data_demo/eusilc_raw/2010/cross_rev4</code>and writes the merged output in <code>csv</code> format in <code>~/data_demo/eusilc_merged/2010</code> with filename <code>2010per_merge_cross.csv</code>. In addition, function returns <code>data.frame</code> object <code>per_cross_2010</code> in the R session.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(r.eusilc)
per_cross_2010 &lt;-<span class="st"> </span><span class="kw">merge_eusilc</span>(<span class="dt">path.personal.register  =</span> <span class="st">&quot;~/demo_data/eusilc_raw/2010/cross_rev4/UDB_c10R_ver 2010-5 from 01-03-14.csv&quot;</span>,
                               <span class="dt">path.personal.data      =</span> <span class="st">&quot;~/demo_data/eusilc_raw/2010/cross_rev4/UDB_c10P_ver 2010-5 from 01-03-14.csv&quot;</span>,
                              <span class="dt">output.path=</span><span class="st">&quot;~/demo_data/eusilc_merged/2010&quot;</span>,
                              <span class="dt">level=</span><span class="st">&quot;personal&quot;</span>,
                              <span class="dt">type=</span><span class="st">&quot;cross-sectional&quot;</span>,
                              <span class="dt">year=</span><span class="st">&quot;2010&quot;</span>,
                              <span class="dt">format=</span><span class="st">&quot;RData&quot;</span>,
                              <span class="dt">subset.vars.per.reg=</span><span class="st">&quot;all&quot;</span>,
                              <span class="dt">subset.vars.per.data=</span><span class="st">&quot;all&quot;</span>,
                              <span class="dt">subset.vars.hh.reg=</span><span class="st">&quot;all&quot;</span>,
                              <span class="dt">subset.vars.hh.data=</span><span class="st">&quot;all&quot;</span>,
                              <span class="dt">subset.countries=</span><span class="st">&quot;all&quot;</span>) </code></pre>
<p>You can create a boxplot on <em>Employee cash or near cash income(net)</em> <a href="http://www.gesis.org/?id=2643#PY010N"><code>PY010N</code></a> by sex <a href="http://www.gesis.org/?id=2639#RB090"><code>RB090</code></a> and country <a href="http://www.gesis.org/?id=2639#RB020"><code>RB020</code></a> with following code:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># removing NA values from sex-variable</span>
plot_data &lt;-<span class="st"> </span>per_cross_2010[!<span class="kw">is.na</span>(per_cross_2010$RB090),]
<span class="co"># relevelling the sex-variable</span>
plot_data$RB090[plot_data$RB090 ==<span class="st"> </span><span class="dv">1</span>] &lt;-<span class="st"> &quot;male&quot;</span>
plot_data$RB090[plot_data$RB090 ==<span class="st"> </span><span class="dv">2</span>] &lt;-<span class="st"> &quot;female&quot;</span>

<span class="kw">library</span>(ggplot2)
<span class="kw">ggplot</span>(plot_data, <span class="kw">aes</span>(<span class="dt">x=</span><span class="kw">factor</span>(RB090), <span class="dt">y=</span>PY010N)) +
<span class="st">  </span><span class="kw">geom_boxplot</span>() +
<span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">50000</span>)) +
<span class="st">  </span><span class="kw">facet_wrap</span>(~RB020)</code></pre>
<div class="figure">
<img src="figure/case2plot.png" />
</div>
<h2 id="individual-level-dataset-with-household-level-variables-from-cross-sectional-data"><span class="header-section-number">3.3</span> Individual level dataset with household level variables from cross-sectional data</h2>
<p>Here we are merging the household register with household data files and then merging the merged household register and data files into it. Function reads the raw -csv files in <code>~/data_demo/eusilc_raw/2010/cross_rev4</code>and writes the merged output in <code>csv</code> format in <code>~/data_demo/eusilc_merged/2010</code> with filename <code>2010both_merge_cross.csv</code>. In addition, function returns <code>data.frame</code> object <code>both_cross_2010</code> in the R session.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(r.eusilc)
both_cross_2010 &lt;-<span class="st"> </span><span class="kw">merge_eusilc</span>(<span class="dt">path.personal.register  =</span> <span class="st">&quot;~/demo_data/eusilc_raw/2010/cross_rev4/UDB_c10R_ver 2010-5 from 01-03-14.csv&quot;</span>,
                                <span class="dt">path.personal.data      =</span> <span class="st">&quot;~/demo_data/eusilc_raw/2010/cross_rev4/UDB_c10P_ver 2010-5 from 01-03-14.csv&quot;</span>,
                                <span class="dt">path.household.register =</span> <span class="st">&quot;~/demo_data/eusilc_raw/2010/cross_rev4/UDB_c10D_ver 2010-5 from 01-03-14.csv&quot;</span>,
                                <span class="dt">path.household.data     =</span> <span class="st">&quot;~/demo_data/eusilc_raw/2010/cross_rev4/UDB_c10H_ver 2010-5 from 01-03-14.csv&quot;</span>,
                                <span class="dt">output.path=</span><span class="st">&quot;~/demo_data/eusilc_merged/2010&quot;</span>,
                                <span class="dt">level=</span><span class="st">&quot;both&quot;</span>,
                                <span class="dt">type=</span><span class="st">&quot;cross-sectional&quot;</span>,
                                <span class="dt">year=</span><span class="st">&quot;2010&quot;</span>,
                                <span class="dt">format=</span><span class="st">&quot;RData&quot;</span>,
                                <span class="dt">subset.vars.per.reg=</span><span class="st">&quot;all&quot;</span>,
                                <span class="dt">subset.vars.per.data=</span><span class="st">&quot;all&quot;</span>,
                                <span class="dt">subset.vars.hh.reg=</span><span class="st">&quot;all&quot;</span>,
                                <span class="dt">subset.vars.hh.data=</span><span class="st">&quot;all&quot;</span>,
                                <span class="dt">subset.countries=</span><span class="st">&quot;all&quot;</span>) </code></pre>
<p>For this data we shall create a scatterplot where we have household level <em>total disposable household income</em> <a href="http://www.gesis.org/?id=2649#HY020"><code>HY020</code></a> on the x-axis and personal level <em>Employee cash or near cash income(net)</em> <a href="http://www.gesis.org/?id=2643#PY010N"><code>PY010N</code></a> on the y-axis.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
<span class="kw">ggplot</span>(both_cross_2010, <span class="kw">aes</span>(<span class="dt">x=</span>HY020, <span class="dt">y=</span>PY010N)) +
<span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">alpha=</span>.<span class="dv">1</span>, <span class="dt">shape=</span><span class="dv">1</span>) +
<span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span>lm) +
<span class="st">    </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim=</span><span class="kw">c</span>(-<span class="dv">5000</span>,<span class="dv">100000</span>), <span class="dt">ylim=</span><span class="kw">c</span>(-<span class="dv">5000</span>,<span class="dv">50000</span>)) +
<span class="st">    </span><span class="kw">facet_wrap</span>(~RB020)</code></pre>
<div class="figure">
<img src="figure/case3plot.png" />
</div>
<h2 id="individual-level-dataset-with-household-level-variables-from-longitudinal-data"><span class="header-section-number">3.4</span> Individual level dataset with household level variables from longitudinal data</h2>
<p>Here we are merging the personal register with personal data from longitudinal data. Function reads the raw -csv files in <code>~/data_demo/eusilc_raw/2010/longi_rev2</code>and writes the merged output in <code>csv</code> format in <code>~/data_demo/eusilc_merged/2010</code> with filename <code>2010per_merge_longi.csv</code>. In addition, function returns <code>data.frame</code> object <code>per_longi_2010</code> in the R session.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(r.eusilc)
both_longi_2010 &lt;-<span class="st"> </span><span class="kw">merge_eusilc</span>(<span class="dt">path.personal.register  =</span> <span class="st">&quot;~/demo_data/eusilc_raw/2010/longi_rev3/UDB_l10R_ver 2010-4 from 01-03-2014.csv&quot;</span>,
                               <span class="dt">path.personal.data      =</span> <span class="st">&quot;~/demo_data/eusilc_raw/2010/longi_rev3/UDB_l10P_ver 2010-4 from 01-03-2014.csv&quot;</span>,
                               <span class="dt">path.household.register =</span> <span class="st">&quot;~/demo_data/eusilc_raw/2010/longi_rev3/UDB_l10D_ver 2010-4 from 01-03-2014.csv&quot;</span>,
                               <span class="dt">path.household.data     =</span> <span class="st">&quot;~/demo_data/eusilc_raw/2010/longi_rev3/UDB_l10H_ver 2010-4 from 01-03-2014.csv&quot;</span>,
                               <span class="dt">output.path=</span><span class="st">&quot;~/demo_data/eusilc_merged/2010&quot;</span>,
                               <span class="dt">level=</span><span class="st">&quot;both&quot;</span>,
                               <span class="dt">type=</span><span class="st">&quot;longitudinal&quot;</span>,
                               <span class="dt">year=</span><span class="st">&quot;2010&quot;</span>,
                               <span class="dt">format=</span><span class="st">&quot;RData&quot;</span>,
                               <span class="dt">subset.vars.per.reg=</span><span class="st">&quot;all&quot;</span>,
                               <span class="dt">subset.vars.per.data=</span><span class="st">&quot;all&quot;</span>,
                               <span class="dt">subset.vars.hh.reg=</span><span class="st">&quot;all&quot;</span>,
                               <span class="dt">subset.vars.hh.data=</span><span class="st">&quot;all&quot;</span>,
                               <span class="dt">subset.countries=</span><span class="st">&quot;all&quot;</span>) </code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># lets take sample of 500 000</span>
plot_data &lt;-<span class="st"> </span>per_longi_2010[<span class="kw">sample</span>(<span class="dv">1</span>:<span class="kw">nrow</span>(per_longi_2010), <span class="dv">500000</span>,
   <span class="dt">replace=</span><span class="ot">FALSE</span>),] 

<span class="kw">library</span>(ggplot2)
<span class="kw">ggplot</span>(plot_data, <span class="kw">aes</span>(<span class="dt">x=</span>RB010, <span class="dt">y=</span>PY010N, <span class="dt">group=</span>PER_ID)) +
<span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">alpha=</span>.<span class="dv">01</span>, <span class="dt">shape=</span><span class="dv">1</span>) +<span class="st"> </span><span class="kw">geom_line</span>(<span class="dt">alpha=</span>.<span class="dv">1</span>) +
<span class="st">    </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim=</span><span class="kw">c</span>(-<span class="dv">5000</span>,<span class="dv">80000</span>)) +
<span class="st">    </span><span class="kw">facet_wrap</span>(~RB020)    </code></pre>
<div class="figure">
<img src="figure/case4plot.png" />
</div>
<h2 id="pooled-individual-level-dataset-with-household-level-variables-from-longitudinal-data"><span class="header-section-number">3.5</span> Pooled individual level dataset with household level variables from longitudinal data</h2>
<p><strong>Loading the datasets</strong></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(r.eusilc)
both_longi_2010 &lt;-<span class="st"> </span><span class="kw">merge_eusilc</span>(<span class="dt">path.personal.register  =</span> <span class="st">&quot;~/demo_data/eusilc_raw/2010/longi_rev3/UDB_l10R_ver 2010-4 from 01-03-2014.csv&quot;</span>,
                               <span class="dt">path.personal.data      =</span> <span class="st">&quot;~/demo_data/eusilc_raw/2010/longi_rev3/UDB_l10P_ver 2010-4 from 01-03-2014.csv&quot;</span>,
                               <span class="dt">path.household.register =</span> <span class="st">&quot;~/demo_data/eusilc_raw/2010/longi_rev3/UDB_l10D_ver 2010-4 from 01-03-2014.csv&quot;</span>,
                               <span class="dt">path.household.data     =</span> <span class="st">&quot;~/demo_data/eusilc_raw/2010/longi_rev3/UDB_l10H_ver 2010-4 from 01-03-2014.csv&quot;</span>,
                               <span class="dt">output.path=</span><span class="st">&quot;~/demo_data/eusilc_merged/2010&quot;</span>,
                               <span class="dt">level=</span><span class="st">&quot;both&quot;</span>,
                               <span class="dt">type=</span><span class="st">&quot;longitudinal&quot;</span>,
                               <span class="dt">year=</span><span class="st">&quot;2010&quot;</span>,
                               <span class="dt">format=</span><span class="st">&quot;RData&quot;</span>,
                               <span class="dt">subset.vars.per.reg=</span><span class="st">&quot;all&quot;</span>,
                               <span class="dt">subset.vars.per.data=</span><span class="st">&quot;all&quot;</span>,
                               <span class="dt">subset.vars.hh.reg=</span><span class="st">&quot;all&quot;</span>,
                               <span class="dt">subset.vars.hh.data=</span><span class="st">&quot;all&quot;</span>,
                               <span class="dt">subset.countries=</span><span class="st">&quot;all&quot;</span>) 

both_longi_2011 &lt;-<span class="st"> </span><span class="kw">merge_eusilc</span>(<span class="dt">path.personal.register  =</span> <span class="st">&quot;~/demo_data/eusilc_raw/2011/longi_rev1/UDB_l11R_ver 2011-2 from 01-03-2014.csv&quot;</span>,
                               <span class="dt">path.personal.data      =</span> <span class="st">&quot;~/demo_data/eusilc_raw/2011/longi_rev1/UDB_l11P_ver 2011-2 from 01-03-2014.csv&quot;</span>,
                               <span class="dt">path.household.register =</span> <span class="st">&quot;~/demo_data/eusilc_raw/2011/longi_rev1/UDB_l11D_ver 2011-2 from 01-03-2014.csv&quot;</span>,
                               <span class="dt">path.household.data     =</span> <span class="st">&quot;~/demo_data/eusilc_raw/2011/longi_rev1/UDB_l11H_ver 2011-2 from 01-03-2014.csv&quot;</span>,
                               <span class="dt">output.path=</span><span class="st">&quot;~/demo_data/eusilc_merged/2011&quot;</span>,
                               <span class="dt">level=</span><span class="st">&quot;both&quot;</span>,
                               <span class="dt">type=</span><span class="st">&quot;longitudinal&quot;</span>,
                               <span class="dt">year=</span><span class="st">&quot;2011&quot;</span>,
                               <span class="dt">format=</span><span class="st">&quot;RData&quot;</span>,
                               <span class="dt">subset.vars.per.reg=</span><span class="st">&quot;all&quot;</span>,
                               <span class="dt">subset.vars.per.data=</span><span class="st">&quot;all&quot;</span>,
                               <span class="dt">subset.vars.hh.reg=</span><span class="st">&quot;all&quot;</span>,
                               <span class="dt">subset.vars.hh.data=</span><span class="st">&quot;all&quot;</span>,
                               <span class="dt">subset.countries=</span><span class="st">&quot;all&quot;</span>) </code></pre>
<h3 id="selecting-identical-variables-only-nordic-countries-from-both-datasets"><span class="header-section-number">3.5.1</span> Selecting identical variables &amp; only Nordic countries from both datasets</h3>
<pre class="sourceCode r"><code class="sourceCode r">vars.per.reg &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;RB010&quot;</span>, <span class="co"># Year</span>
                  <span class="st">&quot;RB020&quot;</span>, <span class="co"># Country</span>
                  <span class="st">&quot;RB030&quot;</span>, <span class="co"># Personal ID</span>
                  <span class="st">&quot;RB080&quot;</span>, <span class="co"># Year of birth</span>
                  <span class="st">&quot;RB090&quot;</span>, <span class="co"># Sex</span>
                  <span class="st">&quot;RX010&quot;</span>) <span class="co"># Age at the date of the interview</span>

## Personal register data - 2008 oma lista (PL030 case)
vars.per.data &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;PB190&quot;</span>, <span class="co"># Marital status</span>
                   <span class="st">&quot;PB200&quot;</span>, <span class="co"># Consensual union</span>
                   <span class="st">&quot;PL031&quot;</span>, <span class="co"># Self-defined current economic status</span>
                   <span class="st">&quot;PL040&quot;</span>) <span class="co"># Status in employment</span>
                                        

## Household register
vars.hh.reg &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;DB110&quot;</span>) <span class="co"># Household status</span>

## Household data
vars.hh.data &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;HY010&quot;</span>, <span class="co"># Total Household Gross Income</span>
                  <span class="st">&quot;HY020&quot;</span>, <span class="co"># total disposable household income</span>
                  <span class="st">&quot;HY022&quot;</span>, <span class="co"># Total Transposable Household Income before social transfers other than old-age and survivors benefits</span>
                  <span class="st">&quot;HY023&quot;</span>, <span class="co"># Total disposable Household income before social transfers including old-age and survivors benefits</span>
                  <span class="st">&quot;HX040&quot;</span>, <span class="co"># Household size</span>
                  <span class="st">&quot;HX050&quot;</span>, <span class="co"># Equivalent household size</span>
                  <span class="st">&quot;HX090&quot;</span>) <span class="co"># Equivalized disposable household income</span>

subset.vars &lt;-<span class="st"> </span><span class="kw">c</span>(vars.per.reg,vars.per.data,
                 vars.hh.reg,vars.hh.data)
nordic.countries &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;SE&quot;</span>,<span class="st">&quot;NO&quot;</span>,<span class="st">&quot;FI&quot;</span>,<span class="st">&quot;DK&quot;</span>,<span class="st">&quot;IS&quot;</span>)

<span class="co"># subsetting</span>
suse_2010 &lt;-<span class="st"> </span>both_longi_2010[both_longi_2010$RB020 %in%<span class="st"> </span>nordic.countries,
                             subset.vars]
suse_2011 &lt;-<span class="st"> </span>both_longi_2011[both_longi_2011$RB020 %in%<span class="st"> </span>nordic.countries,
                             subset.vars]</code></pre>
<h3 id="row-binding-the-datasets-removing-duplicates"><span class="header-section-number">3.5.2</span> Row binding the datasets &amp; removing duplicates</h3>
<p>Now we have identical variables for both datasets and it is easy to combine them using <code>rbind</code>.</p>
<p>As we have duplicate information from certain individual from certain year from different datas (person x information from year 2009 is in BOTH 2010 and 2011 londitudinal data), we have to remove them and only leave the first occasion of that information.</p>
<pre class="sourceCode r"><code class="sourceCode r">dat &lt;-<span class="st"> </span><span class="kw">rbind</span>(suse_2010,
             suse_2011)
<span class="co">#</span>
dat &lt;-<span class="st"> </span>dat[!<span class="kw">duplicated</span>(dat[<span class="kw">c</span>(<span class="st">&quot;RB010&quot;</span>, <span class="co"># Year</span>
                             <span class="st">&quot;RB020&quot;</span>, <span class="co"># country</span>
                             <span class="st">&quot;RB030&quot;</span>)]),] <span class="co"># personal ID</span></code></pre>
<p>By removing the duplicates we are left with 268522 individuals and we can plor their household income across the years by with following code</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
<span class="kw">ggplot</span>(<span class="dt">data=</span>dat, 
       <span class="kw">aes</span>(<span class="dt">x=</span>RB010,
       <span class="dt">y=</span>HX090,
       <span class="dt">color=</span>RB020,
       <span class="dt">group=</span>RB030)) +
<span class="st">  </span><span class="kw">geom_path</span>(<span class="dt">alpha=</span>.<span class="dv">1</span>) +<span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha=</span>.<span class="dv">1</span>, <span class="dt">size=</span><span class="dv">1</span>)</code></pre>
<div class="figure">
<img src="figure/case5plot.png" />
</div>
</body>
</html>
